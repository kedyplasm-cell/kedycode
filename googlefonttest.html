<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KEDYCODE // SYSTEM_LOG</title>
    
    <link rel="icon" type="image/x-icon" href="favicon.ico">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans+Flex:opsz,wght@6..144,100..1000&display=swap" rel="stylesheet">

    <style>
        :root {
            --google-blue: #1a73e8;
            --kedy-black: #050505;
            --kedy-gray: #121212;
            --text-main: #e8eaed;
            --text-muted: #9aa0a6;
        }

        * { box-sizing: border-box; } /* Fixes overflow issues */

        body {
            font-family: 'Google Sans Flex', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--kedy-black);
            color: var(--text-main);
            line-height: 1.6;
            overflow-x: hidden; /* Prevents horizontal scrolling */
        }

        /* --- HEADER --- */
        .kedycode-header {
            padding: 20px 5%;
            border-bottom: 1px solid var(--kedy-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .brand {
            font-variation-settings: "wght" 900;
            font-size: 1rem;
            letter-spacing: 0.4em;
            color: var(--google-blue);
        }

        /* --- GIANT HERO (Fixes "Going Out" error) --- */
        #blog-container .blog-post:first-child {
            width: 100%;
            min-height: 80vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 60px 5%;
            background: radial-gradient(circle at top left, rgba(26,115,232,0.1) 0%, rgba(5,5,5,1) 80%);
            border-bottom: 1px solid var(--kedy-gray);
        }

        #blog-container .blog-post:first-child .blog-title {
            font-size: clamp(2.5rem, 12vw, 8rem); /* Dynamically shrinks for mobile */
            font-variation-settings: "wght" 1000;
            line-height: 0.9;
            word-wrap: break-word; /* Forces long words to wrap */
            overflow-wrap: break-word;
            margin: 10px 0;
            text-transform: uppercase;
        }

        /* --- CONTENT FEED --- */
        .content-wrapper {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .blog-post { margin-bottom: 80px; width: 100%; }
        .blog-title { font-size: 2.2rem; font-variation-settings: "wght" 800; color: #fff; margin-bottom: 10px; }
        .blog-date { color: var(--google-blue); font-size: 0.8rem; letter-spacing: 0.1em; }
        .blog-content { color: var(--text-muted); white-space: pre-wrap; word-break: break-word; }

        .blog-image { width: 100%; height: auto; border-radius: 4px; margin-top: 20px; }

        /* --- GUESTBOOK --- */
        .guestbook-section { background: #080808; padding: 60px 20px; border-top: 1px solid var(--kedy-gray); }
        .guestbook-inner { max-width: 600px; margin: 0 auto; }
        
        form { display: flex; flex-direction: column; gap: 10px; }
        input, textarea { background: #000; border: 1px solid #222; padding: 15px; color: #fff; font-family: inherit; }
        
        button {
            background: #fff; color: #000; border: none; padding: 15px; 
            font-variation-settings: "wght" 900; cursor: pointer; text-transform: uppercase;
        }
        button:hover { background: var(--google-blue); color: #fff; }

        .entry { border-bottom: 1px solid #111; padding: 20px 0; }
        .hp-field { display: none !important; }
    </style>
</head>
<body>

    <header class="kedycode-header">
        <div class="brand">KEDYCODE // LOG</div>
        <div style="font-size: 0.7rem; opacity: 0.5;">v1.0.4_STABLE</div>
    </header>

    <div id="blog-container"></div>

    <section class="guestbook-section">
        <div class="guestbook-inner">
            <h2 style="font-size: 0.8rem; letter-spacing: 0.2em; color: var(--text-muted);">// COMMUNITY_ACCESS</h2>
            <form id="guestbook-form">
                <input type="text" id="field_id_hp" class="hp-field" tabindex="-1">
                <input type="text" id="username" placeholder="IDENT_ID" required>
                <textarea id="message" placeholder="MESSAGE_DATA" rows="3" required></textarea>
                <button type="submit" id="submit-btn">TRANSMIT</button>
            </form>
            <div id="guestbook-entries"></div>
        </div>
    </section>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDYKiSy9Crp46_p6SbEdjDnw4R5UAdNdnU",
            authDomain: "guestbook-4b0fd.firebaseapp.com",
            projectId: "guestbook-4b0fd",
            storageBucket: "guestbook-4b0fd.firebasestorage.app",
            messagingSenderId: "433054381228",
            appId: "1:433054381228:web:b3cf0a181ca523ebfadb09",
            measurementId: "G-MV7JN1NVGC"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // BLOG
        onSnapshot(query(collection(db, "posts"), orderBy("createdAt", "desc")), (snapshot) => {
            const container = document.getElementById('blog-container');
            container.innerHTML = "";
            snapshot.forEach((doc, index) => {
                const post = doc.data();
                const wrapperStart = index === 0 ? '' : '<div class="content-wrapper">';
                const wrapperEnd = index === 0 ? '' : '</div>';
                const img = post.imageUrl ? `<img src="${post.imageUrl}" class="blog-image">` : '';

                container.innerHTML += `
                    ${wrapperStart}
                    <article class="blog-post">
                        <div class="blog-date">// ${post.createdAt?.toDate().toLocaleDateString() || 'NEW'}</div>
                        <div class="blog-title">${post.title}</div>
                        <div class="blog-content">${post.content}</div>
                        ${img}
                    </article>
                    ${wrapperEnd}
                `;
            });
        });

        // GUESTBOOK
        onSnapshot(query(collection(db, "guestbook"), orderBy("createdAt", "desc")), (snapshot) => {
            const gb = document.getElementById('guestbook-entries');
            gb.innerHTML = "";
            snapshot.forEach((doc) => {
                const entry = doc.data();
                gb.innerHTML += `<div class="entry"><b style="color:var(--google-blue)">> ${entry.username}</b><p>${entry.message}</p></div>`;
            });
        });

        // SUBMIT
        document.getElementById('guestbook-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submit-btn');
            btn.disabled = true;
            await addDoc(collection(db, "guestbook"), { 
                username: document.getElementById('username').value, 
                message: document.getElementById('message').value, 
                createdAt: serverTimestamp() 
            });
            document.getElementById('guestbook-form').reset();
            btn.disabled = false;
        });
    </script>
</body>
</html>
